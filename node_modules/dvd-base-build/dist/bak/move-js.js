'use strict';

var _gulp = require('gulp');

var _gulp2 = _interopRequireDefault(_gulp);

var _util = require('../util.js');

var _util2 = _interopRequireDefault(_util);

var _gulpUglify = require('gulp-uglify');

var _gulpUglify2 = _interopRequireDefault(_gulpUglify);

var _swgGulpRev = require('swg-gulp-rev');

var _swgGulpRev2 = _interopRequireDefault(_swgGulpRev);

var _gulpSize = require('gulp-size');

var _gulpSize2 = _interopRequireDefault(_gulpSize);

var _config = require('../config.js');

var _config2 = _interopRequireDefault(_config);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/************************************ 只移动、不编译的JS ************************************/

// JS公共编译方法
// 修改文件名增加md5，并生成rev-md5.json
function moveJs() {
  console.log('>>>>>>>>>>>>>>> move-js\u6587\u4EF6\u5F00\u59CB\u7F16\u8BD1\u3002' + _util2.default.getNow());

  // 编译并返回流
  return _gulp2.default.src(_config2.default.path.moveJs);
}

// 开发环境JS编译
// 显示gulp.dest输出到磁盘上的文件尺寸
// js压缩混淆
_gulp2.default.task('move-js:dev', function () {
  return moveJs()
  // 显示文件体积
  .pipe((0, _gulpSize2.default)({ showFiles: true }))
  // 输出
  .pipe(_gulp2.default.dest('dist/static'));
});

// 生产环境JS编译
_gulp2.default.task('move-js:dist', function () {
  return moveJs().pipe((0, _gulpUglify2.default)())
  // 收集JS文件的MD5
  .pipe((0, _swgGulpRev2.default)())
  // 显示文件体积
  .pipe((0, _gulpSize2.default)({ showFiles: true }))
  // 输出JS
  .pipe(_gulp2.default.dest('dist/static'))
  // 记录MD5
  .pipe(_swgGulpRev2.default.manifest('rev-md5/js-move.json'))
  // 输出MD5
  .pipe(_gulp2.default.dest(_config2.default.path.temp));
});