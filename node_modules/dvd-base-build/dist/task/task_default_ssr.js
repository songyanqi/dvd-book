'use strict';

var _gulp = require('gulp');

var _gulp2 = _interopRequireDefault(_gulp);

var _runSequence = require('run-sequence');

var _runSequence2 = _interopRequireDefault(_runSequence);

var _gulpLivereload = require('gulp-livereload');

var _gulpLivereload2 = _interopRequireDefault(_gulpLivereload);

var _util = require('../util.js');

var _util2 = _interopRequireDefault(_util);

var _config = require('../config.js');

var _config2 = _interopRequireDefault(_config);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// 自定义
require('./task_js_ssr.js'); // 第三方

_gulp2.default.task('default', function () {
  // 打印发布版本
  console.log('~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u53D1\u5E03ssr~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~');

  // 按顺序编译
  return (0, _runSequence2.default)(['task_js_ssr'], function () {
    // 打印发布版本
    console.log('~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ssr\u53D1\u5E03\u5B8C\u6BD5(\u5168\u90E8\u7F16\u8BD1&&\u538B\u7F29)~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~');

    // 文件变化回调函数
    var changeCallback = function changeCallback(event) {
      console.log('\u68C0\u6D4B\u5230' + event.path + '\u6587\u4EF6\u53D1\u751F\u6539\u53D8\uFF0C\u5F00\u59CB\u6267\u884C\u4EFB\u52A1...');
    };

    // 更新静态资源时间戳
    _config2.default.replacer['[[v]]'] = '?v=' + _util2.default.getTimeFormatVersion();

    var watchDir = '{src,node_modules/dvd-*,module,stylesheet,utils}/**';

    // 监视js,vue,json变化，触发js编译
    _gulp2.default.watch(watchDir + '/!*.{js,vue,json' + (_config2.default.pkg.name == 'm' ? ',es6' : '') + '}', ['task_js_ssr']).on('change', changeCallback);

    console.log('>>>>>>>>>>>>>>> gulp\u5F00\u59CB\u76D1\u542C{src,node_modules/dvd-*}\u76EE\u5F55\u6587\u4EF6\u53D8\u5316...' + _util2.default.getNow());

    require('./server.js');
  });
});