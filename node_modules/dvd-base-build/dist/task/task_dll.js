'use strict';

var _gulp = require('gulp');

var _gulp2 = _interopRequireDefault(_gulp);

var _gulpSize = require('gulp-size');

var _gulpSize2 = _interopRequireDefault(_gulpSize);

var _webpack = require('webpack');

var _webpack2 = _interopRequireDefault(_webpack);

var _swgGulpRev = require('swg-gulp-rev');

var _swgGulpRev2 = _interopRequireDefault(_swgGulpRev);

var _gulpEslint = require('gulp-eslint');

var _gulpEslint2 = _interopRequireDefault(_gulpEslint);

var _gulpUglify = require('gulp-uglify');

var _gulpUglify2 = _interopRequireDefault(_gulpUglify);

var _gulpReplace = require('gulp-replace');

var _gulpReplace2 = _interopRequireDefault(_gulpReplace);

var _webpackStream = require('webpack-stream');

var _webpackStream2 = _interopRequireDefault(_webpackStream);

var _util = require('../util.js');

var _util2 = _interopRequireDefault(_util);

var _config = require('../config.js');

var _config2 = _interopRequireDefault(_config);

var _eslintrc = require('../eslintrc.js');

var _eslintrc2 = _interopRequireDefault(_eslintrc);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/************************************ 构建JS任务 ************************************/
_gulp2.default.task('task_dll', function () {
  console.log('>>>>>>>>>>>>>>> js\u6587\u4EF6\u5F00\u59CB\u7F16\u8BD1\u3002' + _util2.default.getNow());

  return _gulp2.default.src(_config2.default.path.dll)

  // js压缩混淆
  // .pipe(config.env.mini ? uglify() : util.gulpNothing())

  // 显示编译后js文件体积
  .pipe((0, _gulpSize2.default)({ showFiles: true }))

  // 收集js文件的MD5值
  .pipe(_config2.default.env.mini ? (0, _swgGulpRev2.default)() : _util2.default.gulpNothing())

  // 输出js文件
  .pipe(_gulp2.default.dest(_config2.default.path.static + '/common'))

  // 输出js文件与MD5值匹配关系的文件
  .pipe(_config2.default.env.mini ? _swgGulpRev2.default.manifest('rev-md5/dll.json') : _util2.default.gulpNothing()).pipe(_config2.default.env.mini ? _gulp2.default.dest(_config2.default.path.temp) : _util2.default.gulpNothing());
});

// 自定义
// 第三方