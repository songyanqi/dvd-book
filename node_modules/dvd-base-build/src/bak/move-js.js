import gulp from 'gulp';
import util from '../util.js';
import uglify from 'gulp-uglify';		          // js压缩混淆
import rev from 'swg-gulp-rev';		                // 修改文件名增加md5，并生成rev-md5.json
import size from 'gulp-size';		// 显示gulp.dest输出到磁盘上的文件尺寸
import config from '../config.js';


/************************************ 只移动、不编译的JS ************************************/

// JS公共编译方法
function moveJs() {
  console.log(`>>>>>>>>>>>>>>> move-js文件开始编译。${util.getNow()}`);

  // 编译并返回流
  return gulp.src(config.path.moveJs);
}

// 开发环境JS编译
gulp.task('move-js:dev', () => {
  return moveJs()
  // 显示文件体积
    .pipe(size({showFiles: true}))
    // 输出
    .pipe(gulp.dest('dist/static'));
});

// 生产环境JS编译
gulp.task('move-js:dist', () => {
  return moveJs()
    .pipe(uglify())
    // 收集JS文件的MD5
    .pipe(rev())
    // 显示文件体积
    .pipe(size({showFiles: true}))
    // 输出JS
    .pipe(gulp.dest('dist/static'))
    // 记录MD5
    .pipe(rev.manifest('rev-md5/js-move.json'))
    // 输出MD5
    .pipe(gulp.dest(config.path.temp));
});
